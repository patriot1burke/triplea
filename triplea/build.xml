<?xml version="1.0"?>


<project name="TripleA" basedir="." default="compile">

  <property file=".ant.properties"/>

  <path id="full.path">
    <pathelement path="${junit.home}"/>
    <pathelement path="${junit.jar}"/>
    <pathelement path="lib\kunststoff.jar"/>
    <pathelement path="${classpath}"/>
    <pathelement path="classes/"/>
  </path>

  <target name="init">
  </target>

  <target name="all" depends="init,clean,compile,test,zip, zipSource">
  </target>

  <target name="clean" depends="init"
          description="Remove all release, class and saved game files">
    <delete dir="release"/>
    <delete dir="classes"/>
    <delete dir="savedGames"/>
  </target>

  <target name="compile" depends="init"
          description="Compile the source files and copy over the resource files">
    <echo message="looking for junit.jar in:${junit.jar}, edit .ant.properties to set junit location"/>
    <mkdir dir="classes"/>
    <copy todir="classes">
      <fileset dir="data">
        <include name="**/*.dtd"/>
        <include name="**/*.gif"/>
        <include name="**/*.png"/>
        <include name="**/*.txt"/>
        <include name="**/*.xml"/>
      </fileset>
    </copy>
    <javac srcdir="src/"
           destdir="classes/"
           debug="true"
           deprecation="true"
           classpathref="full.path"/>
  </target>

  <target name ="compileClean" depends="clean,compile"
          description="Clean then compile"/>

  <target name="zip" depends="init,compile"
          description="create a zip file for end users">
    <mkdir dir="release" />
    <zip zipfile="release/triplea.zip" compress="true" >
      <zipfileset dir="classes/" prefix="classes/">
        <include name="**/*.class"/>
		<!-- dont put Test classes in the main distribution -->
		<exclude name="**/*Test.class"/>
        <include name="**/*.dtd"/>
        <include name="**/*.gif"/>
        <include name="**/*.png"/>
        <include name="**/*.txt"/>
      </zipfileset>
      <zipfileset dir="lib/" prefix="lib/">
        <include name="**/*.jar"/>
      </zipfileset>
      <zipfileset dir="doc/" prefix="doc/">
        <include name="**/*.html"/>
      </zipfileset>
      <zipfileset dir="liscence/" prefix="liscence/">
        <include name="gpl.txt"/>
      </zipfileset>
      <zipfileset dir="bin/" prefix="bin/">
        <include name="triplea.bat"/>
        <include name="triplea.sh"/>
        <include name="triplea.irix.sh"/>
      </zipfileset>
      <zipfileset dir="games/" prefix="games/">
        <include name="*.xml"/>
      </zipfileset>
      <zipfileset dir=".">
        <include name="readme.html"/>
      </zipfileset>
    </zip>
  </target>

  <target name="zipSource" depends="init"
          description="create a zip file for developers">
    <mkdir dir="release" />
    <zip zipfile="release/triplea_source.zip" compress="true" >
      <zipfileset dir="src/" prefix="src/">
        <include name="**/*.java"/>
      </zipfileset>
      <zipfileset dir="junit/" prefix="junit/">
        <include name="excluded.properties"/>
      </zipfileset>
      <zipfileset dir="lib/" prefix="lib/">
        <include name="**/*.jar"/>
      </zipfileset>
      <zipfileset dir="data/" prefix="data/">
        <include name="**/*.dtd"/>
        <include name="**/*.gif"/>
        <include name="**/*.png"/>
        <include name="**/*.txt"/>
        <include name="**/*.xml"/>
      </zipfileset>
      <zipfileset dir="bin/" prefix="bin/">
        <include name="triplea.bat"/>
        <include name="triplea.sh"/>
        <include name="triplea.irix.sh"/>
      </zipfileset>
      <zipfileset dir=".">
        <include name="build.xml"/>
        <include name=".ant.properties"/>
        <include name="readme.html"/>
      </zipfileset>
      <zipfileset dir="doc/" prefix="doc/">
        <include name="**/*.html"/>
      </zipfileset>
      <zipfileset dir="liscence/" prefix="liscence/">
        <include name="gpl.txt"/>
      </zipfileset>
      <zipfileset dir="games/" prefix="games/">
        <include name="*.xml"/>
      </zipfileset>
    </zip>
  </target>

  <target name="javadoc" depends="init"
          description="Generate JavaDoc documentation">
    <delete dir="apidoc"/>
    <mkdir dir="apidoc"/>
    <javadoc destdir="apidoc" Verbose="off">
      <package name="games.strategy.*"/>
      <sourcepath>
        <pathelement location="src/"/>
      </sourcepath>
    </javadoc>
  </target>

  <target name="test" depends="init,compile"
          description="run junit tests">
    <junit fork="yes" haltonerror="on">
      <classpath>
        <pathelement path="${junit.home}"/>
        <pathelement path="${junit.jar}"/>
        <pathelement path="${classpath}"/>
        <pathelement path="classes/"/>
      </classpath>
      <formatter type="plain" />
      <test name="games.strategy.StrategyGameTest" />
      <test name="games.strategy.triplea.delegate.DelegateTest" />
    </junit>
  </target>
</project>
